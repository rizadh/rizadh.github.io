"use strict";function startupAnimation(){function t(){function t(){return e+a-(new Date).getTime()}var e=parseInt(localStorage.getItem("timeStarted")),a=parseInt(localStorage.getItem("durationSet")),i={text:"No",style:"alert",clickFunction:function(){localStorage.setItem("timeStarted","0"),localStorage.setItem("durationSet","0")}},o={text:"Sure",style:"emphasize",clickFunction:function(e){var i=1-t()/a;t()>0?($("#dial-ring path").data("timeLeft",t()),$("#dial-ring path").data("progress",i),startTimer(!1,!0)):(e.stopPropagation(),showNotification("Too late, the timer has already ended",[{text:"Dismiss",style:"normal",clickFunction:function(){}}]))}};if(e&&a){var n=10;if(t()>1e3*n){var s="Seems like the timer was still running when you last closed this app. Do you want to restore the timer?";showNotification(s,[i,o])}}}var e=ANIMATION_DURATION,a=$("#display"),i=$("#display-text"),o=$("#keypad tr");validTimeString(GET("time"))?(setDisplayTime(("000000"+GET("time")).slice(-6)),$.Velocity.hook(a,"height","0"),$.Velocity.hook(a,"opacity","0"),$.Velocity.hook(a,"fontSize","0"),$.Velocity.hook($("#keypad"),"opacity","0"),startTimer()):($.Velocity.hook(i,"translateY","-100%"),$.Velocity.hook(i,"opacity","0"),$.Velocity.hook(a,"translateY","-100%"),$.Velocity.hook(a,"opacity","0"),$.Velocity.hook(o,"opacity","0"),$.Velocity.hook(o,"translateY","-10%"),$.Velocity.RegisterEffect("transition.slideIn",{calls:[[{translateY:0,opacity:1}]]}),i.velocity({translateY:"-50%",opacity:1},{easing:EASE_OUT,duration:e}),a.velocity({translateY:0,opacity:1},{easing:EASE_OUT,duration:e,complete:t}),o.velocity("transition.slideIn",{easing:EASE_OUT,duration:e/2,delay:e/4,stagger:e/4/(o.length-1),drag:!0,display:null}))}function getDisplayTime(t){var e=$("#display-text");return t?e.text():e.data("currentTime")}function validTimeString(t){var e=3600*t.slice(-6,-4),a=60*t.slice(-4,-2),i=1*t.slice(-2),o=e+a+i;return o>0&&36e4>t}function setDisplayTime(t,e,a){function i(t,e){$("#display-text-old").remove();var a=$("#display-text");if("fancy"===e){var i=a.text(),o=t.text(),n=[],s=[];if(i.length===o.length)for(var l=0;l<i.length;l++)i[l]===o[l]?(n.push(i[l]),s.push(o[l])):(n.push("<span>"),n.push(i[l]),n.push("</span>"),s.push("<span>"),s.push(o[l]),s.push("</span>"));else n.push("<span>"),n.push(i),n.push("</span>"),s.push("<span>"),s.push(o),s.push("</span>");var c=/<\/span><span>/gi;a.attr("id","display-text-old").html(n.join("").replace(c,"")).children("span").velocity({opacity:0,scale:.5},{easing:EASE_OUT,duration:ANIMATION_DURATION,queue:!1,display:"inline-block",complete:function(){$(this).parent().remove()}}),t.html(s.join("").replace(c,"")).appendTo("#display").children("span").css("opacity",0).velocity({opacity:[1,0],scale:[1,.5]},{easing:EASE_OUT,duration:ANIMATION_DURATION,queue:!1,display:"inline-block"})}else a.remove(),t.appendTo("#display")}var o=$("#display-text"),n=o.clone(!0);if(e)n.data("currentTime","000000").text(t).css("font-family","roboto_condensedregular"),i(n,a?"fancy":"");else if(""===t)o.data("currentTime","000000").text("Enter a time").css("font-family","roboto_condensedregular");else if("000000"===t)n.data("currentTime","000000").text("0s").css("font-family","robotoregular"),i(n,a?"fancy":"");else if("Done"===t)n.data("currentTime","000000").text(t).css("font-family","robotoregular"),i(n,a?"fancy":"");else if("Paused"===t)n.text(t).css("font-family","robotoregular"),i(n,a?"fancy":"");else if(o.data("currentTime")!==t||"Paused"===o.text()){n.data("currentTime",t).css("font-family","robotoregular");for(var s=[],l=["h","m","s"],c=0;3>c;c++){var r=t.slice(2*c,2*c+2);(r>0||s[0]||2===c)&&(10>r&&!s[0]&&(r=r.slice(-1)),s.push(r+l[c]))}var d=s.join(" ");n.text(d),i(n,a?"fancy":"")}}function addDigit(t){var e=(getDisplayTime()+t).slice(-6);setDisplayTime(e)}function startTimer(t,e){function a(t,e){function a(t,e,a){var i=50,o=i-e,n=a>=.5?1:0,s=o+e*(1+Math.sin(2*Math.PI*a)),l=o+e*(1-Math.cos(2*Math.PI*a)),c=s+" "+l,r=e+" "+e,d=" 0 "+n+" 1 ",p="M"+i+" "+i,u="m0 "+-e,y="A"+r+d+c,g=p+u+y;t.attr("d",g)}var i=$("#dial-ring path"),o=e?i.data("timeLeft"):1e3*t,n=e?i.data("progress"):0;i.velocity("stop").velocity({tween:[WHOLECIRCLE,n]},{duration:o,easing:"linear",begin:function(){localStorage.setItem("timeStarted",(new Date).getTime()),localStorage.setItem("durationSet",o)},progress:function(t,e,o,n,s){a(i,40,s),i.data("progress",s),i.data("timeLeft",o);var l=Math.ceil(o/1e3),c=Math.floor(l/60)%60,r=Math.floor(l/3600),d=l%60;d=("0"+d).slice(-2),c=("0"+c).slice(-2),r=("0"+r).slice(-2);var p=[r,c,d];0!==o&&setDisplayTime(p.join(""),!1,!0)},complete:function(){setDisplayTime("Done",!1,!0),$("#display").removeClass("running"),localStorage.setItem("timeStarted",0),localStorage.setItem("durationSet",0)}})}var i=getDisplayTime(),o=3600*i.slice(-6,-4),n=60*i.slice(-4,-2),s=1*i.slice(-2),l=o+n+s;0!==l||t||e?36e4>l||e||t?(a(l,t||e),$("#display").data("inputMode",!1),$("#display").addClass("running"),t||($("#display").velocity("stop").velocity({height:"90%",opacity:1,fontSize:"1em"},{duration:ANIMATION_DURATION,easing:EASE_OUT}),$("#keypad").velocity("stop").velocity({translateY:"10%",opacity:0},{easing:EASE_OUT,duration:ANIMATION_DURATION,display:"none"}),$("#edit-button").velocity("stop").velocity({translateY:[0,"100%"],opacity:[1,0]},{easing:EASE_OUT,duration:ANIMATION_DURATION,display:"block"}),$("#dial-ring").velocity("stop").velocity({opacity:[1,0],scale:[1,0]},{easing:EASE_OUT,duration:ANIMATION_DURATION,display:"block"}))):setDisplayTime("Time too high",!0,!0):setDisplayTime("No time entered",!0,!0)}function editTime(){setDisplayTime(getDisplayTime(),!1,!0),$("#display").data("inputMode",!0).data("paused",!1),$("#display").removeClass("running"),localStorage.setItem("timeStarted",0),localStorage.setItem("durationSet",0),$("#dial-ring path").velocity("stop"),$("#display").velocity("stop").velocity({height:"20%"},{duration:ANIMATION_DURATION,easing:EASE_OUT}),$("#keypad").velocity("stop").velocity({translateY:0,opacity:1},{easing:EASE_OUT,duration:ANIMATION_DURATION,display:"table"}),$("#edit-button").velocity("stop").velocity({opacity:0,translateY:"-700%"},{easing:EASE_OUT,display:"none",duration:ANIMATION_DURATION}),$("#dial-ring").velocity("stop").velocity("fadeOut",100)}function togglePause(){if(!$("#display").data("inputMode"))if($("#display").data("paused"))startTimer(!0),$("#display").data("paused",!1),$("#dial-ring").velocity("stop").velocity({opacity:1},{easing:EASE_OUT,duration:ANIMATION_DURATION});else{var t=$("#dial-ring path").attr("class"),e=~t.indexOf("velocity-animating");e&&($("#dial-ring path").velocity("stop"),setDisplayTime("Paused",!1,!0),$("#display").data("paused",!0),$("#dial-ring").velocity("stop").velocity({opacity:.25},{easing:EASE_OUT,duration:ANIMATION_DURATION}))}}function toggleKeyboardHelp(t){var e=$("#keyboard-help");if(arguments.length>0)!!e.data("shown")==!t&&toggleKeyboardHelp();else{var a=!e.data("shown");e.data("shown",a).velocity("stop").velocity({scale:a?[1,0]:[0,1],opacity:a?[1,0]:[0,1]},{easing:a?EASE_OUT:EASE_IN,display:a?"block":"none",duration:a?ANIMATION_DURATION:ANIMATION_DURATION/4})}}function showNotification(t,e){for(var a=$("#notification-banner span").text(t),i=a.siblings("div").empty(),o=e.length-1;o>=0;o--){var n=e[o];$("<div></div>").text(n.text).addClass(n.style+" button").click(n.clickFunction).prependTo(i)}a.parent().velocity("stop").velocity({translateY:a.parent().data("shown")?0:[0,"-100%"]},{easing:EASE_OUT,display:"block",duration:ANIMATION_DURATION}).data("shown",!0)}function hideNotification(){var t=$("#notification-banner");t.data("shown")&&$("#notification-banner").data("shown",!1).velocity("stop").velocity({translateY:"-100%"},{easing:EASE_IN,display:"none",duration:ANIMATION_DURATION/4})}function hoverTouchUnstick(){if("ontouchstart"in document.documentElement)for(var t=document.styleSheets.length-1;t>=0;t--){var e=document.styleSheets[t];if(e.cssRules)for(var a=e.cssRules.length-1;a>=0;a--){var i=e.cssRules[a];i.selectorText&&(i.selectorText=i.selectorText.replace(":hover",":active"))}}}function GET(t,e){e=e?e:window.location.search;var a=new RegExp("&amp;"+t+"=([^&amp;]*)","i");return e=(e=e.replace(/^\?/,"&amp;").match(a))?e[1]:""}var WHOLECIRCLE=.99999,EASEFUNC="Expo",EASE_OUT="easeOut"+EASEFUNC,EASE_IN="easeIn"+EASEFUNC,ANIMATION_DURATION=400;$(function(){FastClick.attach(document.body),$.Velocity.hook($("#keyboard-help"),"translateX","-50%"),$.Velocity.hook($("#keyboard-help"),"translateY","-50%"),$.Velocity.hook($("#display-text"),"translateY","-50%"),navigator.platform.match(/(Mac|iPhone|iPod|iPad)/i)&&$("#keyboard-help > .shortcut.delete > span").text("Delete"),window.navigator.standalone&&$(document).on("touchmove",!1),hoverTouchUnstick(),$("#display").data("inputMode",!0),startupAnimation(),setDisplayTime(""),$("#keypad td").click(function(){var t=$(this).text();"Clear"==t?setDisplayTime("000000"):"Start"==t?startTimer():addDigit(t)}),$("#edit-button").click(editTime),$("#display-text").click(togglePause),$("#notification-banner").click(function(t){t.stopPropagation(),hideNotification()}),$(document).on("keydown",function(t){var e=t.keyCode;switch(e){case 8:if(t.preventDefault(),$("#display").data("inputMode")){var a=("0"+getDisplayTime()).slice(-7,-1);setDisplayTime(a)}break;case 13:$("#display").data("inputMode")?startTimer():editTime();break;case 27:$("#display").data("inputMode")||editTime();break;case 32:$("#display").data("inputMode")?toggleKeyboardHelp():togglePause();break;case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:if($("#display").data("inputMode")){var i=String.fromCharCode(e);addDigit(i);break}}32!==e&&toggleKeyboardHelp(!1)}),$(document).on("touchstart",function(){localStorage.setItem("touch-device","true")}),$(document).click(function(){toggleKeyboardHelp(!1);var t=localStorage.getItem("touch-device"),e=localStorage.getItem("mouse-suggested"),a=sessionStorage.getItem("mouse-suggested"),i="temp"===e,o=i&&!a;t||e&&!o||(localStorage.setItem("mouse-suggested","true"),sessionStorage.setItem("mouse-suggested","true"),showNotification("Seems like you have a keyboard. Want to learn a few shortcuts?",[{text:"Never",style:"alert",clickFunction:function(){}},{text:"Not right now",style:"normal",clickFunction:function(){localStorage.setItem("mouse-suggested","temp")}},{text:"Yes, show me",style:"emphasize",clickFunction:function(){toggleKeyboardHelp(!0)}}]))}),$(window).on("load resize orientationChange",function(){var t=Math.min($(window).height(),$(window).width());$("html").css("font-size",t/9)})});