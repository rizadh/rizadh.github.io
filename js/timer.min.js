"use strict";function displayTime(){return $("#display-text").data("currentTime")}function validTimeString(e){var t=3600*e.slice(-6,-4),i=60*e.slice(-4,-2),a=1*e.slice(-2),o=t+i+a;return o>0&&36e4>o}function setDisplayTime(e,t){var i=!1,a="",o="1rem",n="",s=$("#display-text"),l=s.clone(!0).attr("id","display-text-old");switch(e){case"000000":case"":e="0s";case"Done":n="000000";case"Paused":a=e,i=!0;break;default:if(s.data("currentTime")!==e||"Paused"===s.text()){for(var r=[],c=["h","m","s"],d=0;3>d;d++){var p=e.slice(2*d,2*d+2);(p>0||r[0]||2===d)&&(10>p&&!r[0]&&(p=p.slice(-1)),r.push(p+c[d]))}var u=r.join(" ");if(.9*windowHeight>windowWidth&&u.length>8){if(1.5*windowWidth>windowHeight){var h=1/.9,m=1.5,y=windowHeight/windowWidth,g=(m-y)/(m-h);o=8/u.length*(1-g)+g}else o=8/u.length;o+="rem"}n=e,a=u,i=!0}}if(i)if($("#display-text-old").remove(),"crossfade"===t){var f=s.text(),T=a,v="",I="";if(f.length===T.length)for(var d=0;d<f.length;d++)f[d]===T[d]?(v+=f[d],I+=T[d]):(v+="<span>"+f[d]+"</span>",I+="<span>"+T[d]+"</span>");else v="<span>"+f+"</span>",I="<span>"+T+"</span>";var S=/<\/span><span>/gi;l.html(v.replace(S,"").replace(" ","&nbsp;")).children("span").velocity({opacity:[0,1],scale:.5},{easing:EASE_OUT,duration:Math.min(ANIMATION_DURATION,1e3),queue:!1,display:"inline-block",complete:function(){$(this).parent().remove()}}).end().prependTo(s.parent()),s.data("currentTime",n).html(I.replace(S,"").replace(" ","&nbsp;")).css({fontFamily:"robotoregular"}).children("span").css("opacity",0).velocity({opacity:1,scale:[1,.5]},{easing:EASE_OUT,duration:Math.min(ANIMATION_DURATION,1e3),queue:!1,display:"inline-block",complete:function(){$(this).contents().unwrap()}}),s.add(l).velocity({fontSize:o},{easing:[100,10],duration:ANIMATION_DURATION,queue:!1})}else s.data("currentTime",n).css({fontFamily:"robotoregular",fontSize:o}).html(a)}function addDigit(e){var t=(displayTime()+e).slice(-6);setDisplayTime(t)}function startTimer(e,t){var i=$("#display"),a=i.find("#display-text"),o=displayTime(),n=3600*o.slice(-6,-4),s=60*o.slice(-4,-2),l=1*o.slice(-2),r=n+s+l;$.Velocity.hook(a,"translateY","-50%"),0!==r||e||t?36e4>r||t||e?(setTime(r,e||t),i.data("inputMode",!1).addClass("running"),e||(i.velocity("stop").velocity({height:"90%",translateY:0},{duration:ANIMATION_DURATION,easing:EASE_OUT}),$("#keypad").velocity("stop").velocity({translateY:"10%",opacity:0},{easing:EASE_OUT,duration:ANIMATION_DURATION,display:"none"}),$("#edit-button").velocity("stop").velocity({translateY:[0,"100%"],opacity:[1,0]},{easing:EASE_OUT,duration:ANIMATION_DURATION,display:"block"}),$("#dial-ring").velocity("stop").velocity({opacity:[1,0],scale:[1,0]},{easing:EASE_OUT,duration:ANIMATION_DURATION,display:"block"}))):(showNotification("The time entered was too high. Enter a time less than 100 hours"),setDisplayTime("")):showNotification("Please enter a time first")}function setTime(e,t){var i=$("#dial-ring path"),a=t?i.data("timeLeft"):1e3*e,o=t?i.data("progress"):0;i.velocity("stop").velocity({tween:[WHOLECIRCLE,o]},{duration:a,easing:"linear",begin:function(){localStorage.setItem("timeStarted",(new Date).getTime()),localStorage.setItem("durationSet",a)},progress:function(e,t,a,o,n){setDial(i,40,n),i.data("progress",n),i.data("timeLeft",a);var s=Math.ceil(a/1e3),l=Math.floor(s/60)%60,r=Math.floor(s/3600),c=s%60;c=("0"+c).slice(-2),l=("0"+l).slice(-2),r=("0"+r).slice(-2);var d=[r,l,c];0!==a&&setDisplayTime(d.join(""),"crossfade")},complete:function(){setDisplayTime("Done","crossfade"),$("#display").removeClass("running"),localStorage.setItem("timeStarted",0),localStorage.setItem("durationSet",0)}})}function setDial(e,t,i){var a=50,o=a-t,n=i>=.5?1:0,s=o+t*(1+Math.sin(2*Math.PI*i)),l=o+t*(1-Math.cos(2*Math.PI*i)),r=s+" "+l,c=t+" "+t,d=" 0 "+n+" 1 ",p="M"+a+" "+a,u="m0 "+-t,h="A"+c+d+r,m=p+u+h;e.attr("d",m)}function editTime(){var e=$("#display");setDisplayTime(displayTime(),"crossfade"),e.data("inputMode",!0).data("paused",!1).removeClass("running"),localStorage.setItem("timeStarted",0),localStorage.setItem("durationSet",0),$("#dial-ring path").velocity("stop"),e.velocity("stop").velocity({height:"20%"},{duration:ANIMATION_DURATION,easing:EASE_OUT}),$("#keypad").velocity("stop").velocity({translateY:0,opacity:1},{easing:EASE_OUT,duration:ANIMATION_DURATION,display:"table"}),$("#edit-button").velocity("stop").velocity({opacity:0,translateY:"-700%"},{easing:EASE_OUT,display:"none",duration:ANIMATION_DURATION}),$("#dial-ring").velocity("stop").velocity("fadeOut",100)}function togglePause(){var e=$("#display");e.data("inputMode")||(e.data("paused")?(startTimer(!0),e.data("paused",!1),$("#dial-ring").velocity("stop").velocity({opacity:1},{easing:EASE_OUT,duration:ANIMATION_DURATION})):e.hasClass("running")?($("#dial-ring path").velocity("stop"),setDisplayTime("Paused","crossfade"),e.data("paused",!0),$("#dial-ring").velocity("stop").velocity({opacity:.25},{easing:EASE_OUT,duration:ANIMATION_DURATION})):editTime())}function toggleKeyboardHelp(e){var t=$("#keyboard-help");if(0===arguments.length){var i=!t.data("shown");t.data("shown",i).velocity("stop").velocity({scaleY:i?[1,0]:[0,1],scaleX:i?[1,.5]:[.5,1],opacity:i?[1,0]:[0,1]},{easing:i?EASE_OUT:EASE_IN,display:i?"block":"none",duration:i?ANIMATION_DURATION:ANIMATION_DURATION/2})}else!!t.data("shown")==!e&&toggleKeyboardHelp()}function showNotification(e,t){var i=$("#notification-banner span").text(e),a=i.siblings("div").empty();if(t){$("#content").css("pointer-events","none");for(var o=t.length-1;o>=0;o--){var n=t[o];$("<div></div>").text(n.text).addClass(n.style+" button").click(n.clickFunction).prependTo(a)}}else clearTimeout(i.data("hideTimeout")),i.data("hideTimeout",setTimeout(hideNotification,5e3));i.parent().velocity("stop").velocity({translateY:i.parent().data("shown")?0:[0,"-100%"]},{easing:EASE_OUT,display:"block",duration:ANIMATION_DURATION,complete:function(){t?$("#content").on("click.bannerhide",hideNotification):$(document).on("click.bannerhide",hideNotification)}}).data("shown",!0)}function hideNotification(){var e=$("#content"),t=$("#notification-banner");$(document).off("click.bannerhide",hideNotification),e.off("click.bannerhide",hideNotification).css("pointer-events",""),t.data("shown")&&$("#notification-banner").data("shown",!1).velocity("stop").velocity({translateY:"-100%"},{easing:EASE_IN,display:"none",duration:ANIMATION_DURATION/2})}function hoverTouchUnstick(){if("ontouchstart"in document.documentElement)for(var e=document.styleSheets.length-1;e>=0;e--){var t=document.styleSheets[e];if(t.cssRules)for(var i=t.cssRules.length-1;i>=0;i--){var a=t.cssRules[i];a.selectorText&&(a.selectorText=a.selectorText.replace(":hover",":active"))}}}function GET(e,t){t=t?t:window.location.search;var i=new RegExp("&amp;"+e+"=([^&amp;]*)","i");return t=(t=t.replace(/^\?/,"&amp;").match(i))?t[1]:""}function isSupportedCSS(e){return e in document.body.style}var WHOLECIRCLE=.99999,EASEFUNC="Expo",EASE_OUT="easeOut"+EASEFUNC,EASE_IN="easeIn"+EASEFUNC,ANIMATION_DURATION=300,windowWidth,windowHeight;$(function(){var e=$("#display"),t=$("#display-text"),i=$("#keypad"),a=$("#keyboard-help");FastClick.attach(document.body),$.Velocity.hook(a,"translateX","-50%"),$.Velocity.hook(a,"translateY","-50%"),$.Velocity.hook(t,"translateX","-50%"),$.Velocity.hook(t,"translateY","-50%"),$.Velocity.hook(i,"translateX","-50%"),navigator.platform.match(/(Mac|iPhone|iPod|iPad)/i)&&a.find(".delete").text("Delete"),window.navigator.standalone&&$(document).on("touchmove",!1),hoverTouchUnstick(),(isSupportedCSS("-webkit-backdrop-filter")||isSupportedCSS("-moz-backdrop-filter")||isSupportedCSS("-o-backdrop-filter")||isSupportedCSS("-ms-backdrop-filter")||isSupportedCSS("backdrop-filter"))&&$("body").addClass("backdrop-filter"),e.data("inputMode",!0),$.Velocity.hook(e,"translateY","-100%"),i.css("opacity",0);var o=GET("time");if(validTimeString(o))setDisplayTime(("000000"+o).slice(-6)),e.css("height","90%"),startTimer();else{$.Velocity.hook(i,"translateY","20%"),$.Velocity.hook(t,"translateY","-100%");var n=1.5*ANIMATION_DURATION;i.velocity({opacity:1,translateY:0},{easing:EASE_OUT,duration:n}),t.velocity({translateY:"-50%",rotateX:0},{easing:EASE_OUT,duration:n}),e.velocity({translateY:0},{easing:EASE_OUT,duration:n,complete:function(){function e(){return t+i-(new Date).getTime()}var t=parseInt(localStorage.getItem("timeStarted")),i=parseInt(localStorage.getItem("durationSet"));if(t&&i){var a=5;if(e()>1e3*a){var o="Seems like the timer was still running when you last closed this app. Do you want to restore the timer?",n={text:"No",style:"alert",clickFunction:function(){localStorage.setItem("timeStarted","0"),localStorage.setItem("durationSet","0")}},s={text:"Sure",style:"emphasize",clickFunction:function(){var t=1-e()/i;e()>0?($("#dial-ring path").data("timeLeft",e()).data("progress",t),startTimer(!1,!0)):showNotification("Too late, the timer has already ended")}};showNotification(o,[n,s])}}}})}t.data("currentTime","000000"),i.on("click","td",function(){var e=$(this).text();"Clear"===e?setDisplayTime(""):"Start"===e?startTimer():addDigit(e)}),$("#edit-button").click(editTime),e.on("click","#display-text",togglePause),$("#notification-banner").on("click",".button",hideNotification),$(document).on("keydown",function(e){var t=$("#notification-banner"),i=e.keyCode;if(t.data("shown")){if(""!==t.find("div").text()){switch(i){case 13:t.find(".emphasize").click();break;case 27:t.find(".alert").click()}return!1}hideNotification()}switch(i){case 8:if(e.preventDefault(),$("#display").data("inputMode")){var a=("0"+displayTime()).slice(-7,-1);setDisplayTime(a)}break;case 13:$("#display").data("inputMode")?startTimer():editTime();break;case 27:$("#display").data("inputMode")||editTime();break;case 32:$("#display").data("inputMode")?toggleKeyboardHelp():togglePause();break;case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:if($("#display").data("inputMode")){var o=String.fromCharCode(i);addDigit(o);break}}32!==i&&toggleKeyboardHelp(!1)}),$(document).on("touchstart",function(){localStorage.setItem("touch-device","true")}),$(document).click(function(e){$(e.target).hasClass("button")||toggleKeyboardHelp(!1);var t=localStorage.getItem("touch-device"),i=localStorage.getItem("mouse-suggested"),a=sessionStorage.getItem("mouse-suggested"),o="temp"===i,n=o&&!a;t||i&&!n||(localStorage.setItem("mouse-suggested","true"),sessionStorage.setItem("mouse-suggested","true"),showNotification("Seems like you have a keyboard. Want to learn a few shortcuts?",[{text:"Never",style:"alert",clickFunction:function(){}},{text:"Not right now",style:"normal",clickFunction:function(){localStorage.setItem("mouse-suggested","temp")}},{text:"Yes, show me",style:"emphasize",clickFunction:function(){toggleKeyboardHelp(!0)}}]))}),$(window).on("load resize orientationChange",function(){var e=$(window);windowWidth=e.width(),windowHeight=e.height();var t=Math.min(1.5*windowWidth,windowHeight);$("html").css("font-size",t/9)})});