"use strict";function startupAnimation(){var e=GLOBALANIMATIONDURATION,t=$("#display"),a=$("#display-text"),i=$("#keypad tr"),o=20;GET("time").length?(setDisplayTime(("000000"+GET("time")).slice(-6),!1,!0),$.Velocity.hook(t,"height","0"),$.Velocity.hook(t,"opacity","0"),$.Velocity.hook(t,"fontSize","0"),$.Velocity.hook($("#keypad"),"opacity","0"),startTimer()):($.Velocity.hook(a,"translateY","-100%"),$.Velocity.hook(a,"opacity","0"),$.Velocity.hook(t,"translateY","-100%"),$.Velocity.hook(t,"opacity","0"),$.Velocity.hook(i,"opacity","0"),$.Velocity.hook(i,"translateY","-10%"),$.Velocity.RegisterEffect("transition.slideIn",{calls:[[{translateY:0,opacity:1}]]}),a.velocity({translateY:"-50%",opacity:1},{easing:GLOBAL_EASE_OUT,duration:e,delay:o}),t.velocity({translateY:0,opacity:1},{easing:GLOBAL_EASE_OUT,duration:e,delay:o,complete:askForRestore}),i.velocity("transition.slideIn",{easing:GLOBAL_EASE_OUT,duration:e/2,delay:e/4+o,stagger:e/4/(i.length-1),drag:!0,display:null}))}function askForRestore(){var e=parseInt(localStorage.getItem("timeStarted")),t=parseInt(localStorage.getItem("durationSet"));if(e&&t){var a=e+t-(new Date).getTime(),i=10;a>1e3*i&&showNotification("Seems like the timer was still running when you last closed this app. Do you want to restore the timer?",[{text:"No",style:"alert",clickFunction:function(){}},{text:"Sure",style:"emphasize",clickFunction:function(a){var i=e+t-(new Date).getTime(),o=1-i/t;i>0?($("#dial-ring path").data("timeLeft",i),$("#dial-ring path").data("progress",o),startTimer(!1,!0)):(a.stopPropagation(),showNotification("Too late, that timer has already ended",[{text:"Dismiss",style:"normal",clickFunction:function(){}}]))}}])}}function setDial(e,t,a){var i=50,o=i-t,s=a>=.5?1:0,n=o+t*(1+Math.sin(2*Math.PI*a)),l=o+t*(1-Math.cos(2*Math.PI*a)),c=n+" "+l,r=t+" "+t,d=" 0 "+s+" 1 ",p="M"+i+" "+i,y="m0 "+-t,u="A"+r+d+c,g=p+y+u;e.attr("d",g)}function setTime(e,t){var a=$("#dial-ring path"),i=t?a.data("timeLeft"):1e3*e,o=t?a.data("progress"):0;a.velocity("stop").velocity({tween:[WHOLECIRCLE,o]},{duration:i,easing:"linear",begin:function(){localStorage.setItem("timeStarted",(new Date).getTime()),localStorage.setItem("durationSet",i)},progress:function(e,t,i,o,s){setDial(a,40,s),a.data("progress",s),a.data("timeLeft",i);var n=Math.ceil(i/1e3),l=Math.floor(n/60)%60,c=Math.floor(n/3600),r=n%60;r=("0"+r).slice(-2),l=("0"+l).slice(-2),c=("0"+c).slice(-2);var d=[c,l,r];0!==i&&setDisplayTime(d.join(""),!1,!0)},complete:function(){setDisplayTime("Done",!1,!0),$("#display").removeClass("running"),localStorage.setItem("timeStarted",0),localStorage.setItem("durationSet",0)}})}function getDisplayTime(e){var t=$("#display-text");return e?t.text():t.data("currentTime")}function setDisplayTime(e,t,a){var i=$("#display-text"),o=i.clone(!0);if(t)o.data("currentTime","000000").text(e).css("font-family","roboto_condensedregular"),changeDisplayText(o,a?"fancy":"");else if(""===e)i.data("currentTime","000000").text("Enter a time").css("font-family","roboto_condensedregular");else if("000000"===e)o.data("currentTime","000000").text("0s").css("font-family","robotoregular"),changeDisplayText(o,a?"fancy":"");else if("Done"===e)o.data("currentTime","000000").text(e).css("font-family","robotoregular"),changeDisplayText(o,a?"fancy":"");else if("Paused"===e)o.text(e).css("font-family","robotoregular"),changeDisplayText(o,a?"fancy":"");else if(i.data("currentTime")!==e||"Paused"===i.text()){o.data("currentTime",e).css("font-family","robotoregular");for(var s=[],n=["h","m","s"],l=0;3>l;l++){var c=e.slice(2*l,2*l+2);(c>0||s[0]||2===l)&&(10>c&&!s[0]&&(c=c.slice(-1)),s.push(c+n[l]))}var r=s.join(" ");o.text(r),changeDisplayText(o,a?"fancy":"")}}function addDigit(e){var t=(getDisplayTime()+e).slice(-6);setDisplayTime(t)}function startTimer(e,t){var a=getDisplayTime(),i=3600*a.slice(-6,-4),o=60*a.slice(-4,-2),s=1*a.slice(-2),n=i+o+s;if(0!==n||e||t)if(36e4>n||t||e){var l=20;setTime(n,e||t),$("#display").data("inputMode",!1),$("#display").addClass("running"),e||($("#display").velocity("stop").velocity({height:"90%",opacity:1,fontSize:"1em"},{duration:GLOBALANIMATIONDURATION,easing:GLOBAL_EASE_OUT,delay:l}),$("#keypad").velocity("stop").velocity({scale:.9,translateY:"20%",opacity:0},{easing:GLOBAL_EASE_OUT,duration:GLOBALANIMATIONDURATION,display:"none",delay:l}),$("#edit-button").velocity("stop").velocity({translateY:[0,"100%"],opacity:[1,0]},{easing:GLOBAL_EASE_OUT,duration:GLOBALANIMATIONDURATION,display:"block",delay:l}),$("#dial-ring").velocity("stop").velocity({opacity:[1,0],scale:[1,0]},{easing:GLOBAL_EASE_OUT,duration:GLOBALANIMATIONDURATION,display:"block",delay:l}))}else setDisplayTime("Time too high",!0,!0);else setDisplayTime("No time entered",!0,!0)}function editTime(){setDisplayTime(getDisplayTime(),!1,!0),$("#display").data("inputMode",!0).data("paused",!1),$("#display").removeClass("running"),localStorage.setItem("timeStarted",0),localStorage.setItem("durationSet",0),$("#dial-ring path").velocity("stop"),$("#display").velocity("stop").velocity({height:"20%"},{duration:GLOBALANIMATIONDURATION,easing:GLOBAL_EASE_OUT}),$("#keypad").velocity("stop").velocity({scale:1,translateY:0,opacity:1},{easing:GLOBAL_EASE_OUT,duration:GLOBALANIMATIONDURATION,display:"table"}),$("#edit-button").velocity("stop").velocity({opacity:0,translateY:"-700%"},{easing:GLOBAL_EASE_OUT,display:"none",duration:GLOBALANIMATIONDURATION}),$("#dial-ring").velocity("stop").velocity("fadeOut",100)}function togglePause(){$("#display").data("inputMode")||($("#display").data("paused")?resumeTimer():pauseTimer())}function pauseTimer(){var e=$("#dial-ring path").attr("class"),t=~e.indexOf("velocity-animating");t&&($("#dial-ring path").velocity("stop"),setDisplayTime("Paused",!1,!0),$("#display").data("paused",!0),$("#dial-ring").velocity("stop").velocity({opacity:.25},{easing:GLOBAL_EASE_OUT,duration:GLOBALANIMATIONDURATION}))}function resumeTimer(){startTimer(!0),$("#display").data("paused",!1),$("#dial-ring").velocity("stop").velocity({opacity:1},{easing:GLOBAL_EASE_OUT,duration:GLOBALANIMATIONDURATION})}function toggleKeyboardHelp(e){var t=$("#keyboard-help");if(arguments.length>0)!!t.data("shown")==!e&&toggleKeyboardHelp();else{var a=!t.data("shown");t.data("shown",a).velocity("stop").velocity({scale:a?[1,0]:[0,1],opacity:a?[1,0]:[0,1]},{easing:a?GLOBAL_EASE_OUT:GLOBAL_EASE_IN,display:a?"block":"none",duration:a?GLOBALANIMATIONDURATION:GLOBALANIMATIONDURATION/4})}}function showNotification(e,t){for(var a=$("#notification-banner span").text(e),i=a.siblings("div").empty(),o=t.length-1;o>=0;o--){var s=t[o];$("<div></div>").text(s.text).addClass(s.style+" button").click(s.clickFunction).prependTo(i)}a.parent().velocity("stop").velocity({translateY:a.parent().data("shown")?0:[0,"-100%"]},{easing:GLOBAL_EASE_OUT,display:"block",duration:GLOBALANIMATIONDURATION}).data("shown",!0)}function hideNotification(){$("#notification-banner").data("shown",!1).velocity("stop").velocity({translateY:"-100%"},{easing:GLOBAL_EASE_IN,display:"none",duration:GLOBALANIMATIONDURATION/4})}function changeDisplayText(e,t){$("#display-text-old").remove();var a=$("#display-text");if("fancy"===t){var i=a.text(),o=e.text(),s=[],n=[];if(i.length===o.length)for(var l=0;l<i.length;l++)i[l]===o[l]?(s.push(i[l]),n.push(o[l])):(s.push("<span>"),s.push(i[l]),s.push("</span>"),n.push("<span>"),n.push(o[l]),n.push("</span>"));else s.push("<span>"),s.push(i),s.push("</span>"),n.push("<span>"),n.push(o),n.push("</span>");var c=/<\/span><span>/gi;a.attr("id","display-text-old").html(s.join("").replace(c,"")).children("span").velocity({opacity:0,scale:.5},{easing:GLOBAL_EASE_OUT,duration:GLOBALANIMATIONDURATION,queue:!1,display:"inline-block",complete:function(){$(this).parent().remove()}}),e.html(n.join("").replace(c,"")).appendTo("#display").children("span").css("opacity",0).velocity({opacity:[1,0],scale:[1,.5]},{easing:GLOBAL_EASE_OUT,duration:GLOBALANIMATIONDURATION,queue:!1,display:"inline-block"})}else a.remove(),e.appendTo("#display")}function hoverTouchUnstick(){if("ontouchstart"in document.documentElement)for(var e=document.styleSheets.length-1;e>=0;e--){var t=document.styleSheets[e];if(t.cssRules)for(var a=t.cssRules.length-1;a>=0;a--){var i=t.cssRules[a];i.selectorText&&(i.selectorText=i.selectorText.replace(":hover",":active"))}}}function GET(e,t){t=t?t:window.location.search;var a=new RegExp("&amp;"+e+"=([^&amp;]*)","i");return t=(t=t.replace(/^\?/,"&amp;").match(a))?t[1]:""}var WHOLECIRCLE=.99999,EASEFUNC="Expo",GLOBAL_EASE_OUT="easeOut"+EASEFUNC,GLOBAL_EASE_IN="easeIn"+EASEFUNC,GLOBALANIMATIONDURATION=400;$(function(){FastClick.attach(document.body),$.Velocity.hook($("#keyboard-help"),"translateX","-50%"),$.Velocity.hook($("#keyboard-help"),"translateY","-50%"),$.Velocity.hook($("#display-text"),"translateY","-50%"),navigator.platform.match(/(Mac|iPhone|iPod|iPad)/i)&&$("#keyboard-help > .shortcut.delete > span").text("Delete"),hoverTouchUnstick(),$("#display").data("inputMode",!0),startupAnimation(),setDisplayTime(""),$("#keypad td").click(function(){var e=$(this).text();"Clear"==e?setDisplayTime("000000"):"Start"==e?startTimer():addDigit(e)}),$("#edit-button").click(editTime),$("#display-text").click(togglePause),$("#notification-banner").click(function(e){e.stopPropagation(),hideNotification()}),$(document).on("keydown",function(e){var t=e.keyCode;switch(t){case 8:if(e.preventDefault(),$("#display").data("inputMode")){var a=("0"+getDisplayTime()).slice(-7,-1);setDisplayTime(a)}break;case 13:$("#display").data("inputMode")?startTimer():editTime();break;case 27:$("#display").data("inputMode")||editTime();break;case 32:$("#display").data("inputMode")?toggleKeyboardHelp():togglePause();break;case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:if($("#display").data("inputMode")){var i=String.fromCharCode(t);addDigit(i);break}}32!==t&&toggleKeyboardHelp(!1)}),$(document).on("touchstart",function(){localStorage.setItem("touch-device","true")}),$(document).click(function(){toggleKeyboardHelp(!1);var e=localStorage.getItem("touch-device"),t=localStorage.getItem("mouse-suggested"),a=sessionStorage.getItem("mouse-suggested"),i="temp"===t,o=i&&!a;e||t&&!o||(localStorage.setItem("mouse-suggested","true"),sessionStorage.setItem("mouse-suggested","true"),showNotification("Seems like you have a keyboard. Want to learn a few shortcuts?",[{text:"Never",style:"alert",clickFunction:function(){}},{text:"Not right now",style:"normal",clickFunction:function(){localStorage.setItem("mouse-suggested","temp")}},{text:"Yes, show me",style:"emphasize",clickFunction:function(){toggleKeyboardHelp(!0)}}]))}),$(window).on("load resize orientationChange",function(){var e=Math.min($(window).height(),$(window).width());$("html").css("font-size",e/9)})});