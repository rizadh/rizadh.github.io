var Events=function(){var a={},b=a.hasOwnProperty;return{subscribe:function(c,d){b.call(a,c)||(a[c]=[]);var e=a[c].push(d)-1;return{remove:function(){delete a[c][e]}}},publish:function(c,d){b.call(a,c)&&a[c].forEach(function(a){a(void 0!==d?d:{})})}}}(),Ripple=function(){"use strict";function a(a,b,c){f=a,g=b,h=c,$(document).on("click.Ripple",function(a){var b=$('<div class="ripple"></div>');$.Velocity.hook(b,"translateX","-50%"),$.Velocity.hook(b,"translateY","-50%"),$.Velocity.hook(b,"scale","0"),b.css({position:"absolute",top:a.pageY,left:a.pageX,width:f,height:f,zIndex:99,opacity:.75,background:g,borderRadius:"100%",pointerEvents:"none"}).velocity({scale:1,opacity:0},{duration:h,easing:"easeOutExpo",complete:function(){$(this).remove()}}).appendTo("body")})}function b(){$(document).off("click.Ripple")}function c(a){f=a}function d(a){g=a}function e(a){h=a}var f,g,h;return{enable:a,disable:b,changeSize:c,changeColor:d,changeDuration:e}}(),App=function(){"use strict";function a(){Ripple.enable("1.5em","white",750),FastClick.attach(document.body);var a=$(window),b=$(document);if(window.navigator.standalone&&b.on("touchmove",!1),"ontouchstart"in document.documentElement)for(var c=document.styleSheets.length-1;c>=0;c--){var d=document.styleSheets[c];if(d.cssRules)for(var f=d.cssRules.length-1;f>=0;f--){var g=d.cssRules[f];g.selectorText&&(g.selectorText=g.selectorText.replace(":hover",":active"))}}(e("-webkit-backdrop-filter")||e("-moz-backdrop-filter")||e("-o-backdrop-filter")||e("-ms-backdrop-filter")||e("backdrop-filter"))&&$("body").addClass("backdrop-filter"),b.on("keydown",function(a){var b=a.keyCode;if(NotificationBanner.isShown){if(NotificationBanner.isEmpty){switch(b){case 13:NotificationBanner.clickButton("emphasize");break;case 27:NotificationBanner.clickButton("alert")}return!1}if(NotificationBanner.hide(),13===b)return!1}switch(b){case 8:if(a.preventDefault(),Display.inputMode){var c=("0"+DisplayText.time).slice(-7,-1);DisplayText.setTime(c)}break;case 13:Display.inputMode?App.startTimer():App.editTime();break;case 27:Display.inputMode||App.editTime();break;case 32:Display.inputMode?HelpMenu.toggle():App.togglePause();break;case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:if(Display.inputMode){var d=String.fromCharCode(b);DisplayText.addDigit(d);break}}32!==b&&HelpMenu.toggle(!1)}),b.on("touchstart",function(){localStorage.setItem("touch-device","true")}),a.on("load resize orientationChange",function(){globals.windowWidth=a.width(),globals.windowHeight=a.height();var b=Math.min(1.5*globals.windowWidth,globals.windowHeight);$.Velocity.hook($("html"),"fontSize",b/9+"px")}),b.click(function(a){$(a.target).hasClass("button")||HelpMenu.toggle(!1);var b=localStorage.getItem("touch-device"),c=localStorage.getItem("mouse-suggested"),d=sessionStorage.getItem("mouse-suggested"),e="temp"===c,f=e&&!d;b||c&&!f||(localStorage.setItem("mouse-suggested","true"),sessionStorage.setItem("mouse-suggested","true"),NotificationBanner.show("Seems like you have a keyboard. Want to learn a few shortcuts?",[{text:"Never",style:"alert",clickFunction:function(){}},{text:"Not right now",style:"normal",clickFunction:function(){localStorage.setItem("mouse-suggested","temp")}},{text:"Yes, show me",style:"emphasize",clickFunction:function(){HelpMenu.toggle(!0)}}]))})}function b(a,b){var c=DisplayText.time,d=3600*c.slice(-6,-4),e=60*c.slice(-4,-2),f=1*c.slice(-2),g=d+e+f;0!==g||a||b?36e4>g||b||a?(DialRing.wind(g,a||b),Display.inputMode=!1,a||Events.publish("start")):(NotificationBanner.show("The time entered was too high. Enter a time less than 100 hours"),DisplayText.setTime("")):NotificationBanner.show("Please enter a time first")}function c(){localStorage.setItem("timeStarted",0),localStorage.setItem("durationSet",0),Events.publish("edit")}function d(){Display.inputMode?App.startTimer():Display.paused?(App.startTimer(!0),Display.paused=!1,Events.publish("resume")):Display.running?(DisplayText.setTime("Paused","crossfade"),Display.paused=!0,Events.publish("pause")):App.editTime()}function e(a){return a in document.body.style}return Events.subscribe("startup",function(){var a=window.location.search,c=new RegExp("&amp;time=([^&amp;]*)","i");a=(a=a.replace(/^\?/,"&amp;").match(c))?a[1]:"",DisplayText.validateTime(a)?(DisplayText.setTime(("000000"+a).slice(-6)),b()):Events.publish("startup.normal")}),{init:a,startTimer:b,editTime:c,togglePause:d}}(),DialRing=function(){"use strict";function a(){h=$("#dial-ring"),i=$("#dial-ring path")}function b(){h.velocity("stop").velocity({opacity:[1,0],scale:[1,0]},{easing:globals.EASE_OUT,duration:globals.ANIMATION_DURATION,display:"block"})}function c(){h.velocity("stop").velocity("fadeOut",100)}function d(){h.velocity("stop").velocity({opacity:1},{easing:globals.EASE_OUT,duration:globals.ANIMATION_DURATION})}function e(){$("#dial-ring").velocity("stop").velocity({opacity:.25},{easing:globals.EASE_OUT,duration:globals.ANIMATION_DURATION})}function f(a,b){var c=b?i.data("timeLeft"):1e3*a,d=b?i.data("progress"):0;i.velocity("stop").velocity({tween:[j,d]},{duration:c,easing:"linear",begin:function(){localStorage.setItem("timeStarted",(new Date).getTime()),localStorage.setItem("durationSet",c)},progress:function(a,b,c,d,e){var f=50,g=40,h=f-g,j=e>=.5?1:0,k=h+g*(1+Math.sin(2*Math.PI*e)),l=h+g*(1-Math.cos(2*Math.PI*e)),m=k+" "+l,n=g+" "+g,o=" 0 "+j+" 1 ",p="M"+f+" "+f,q="m0 "+-g,r="A"+n+o+m;i.attr("d",p+q+r).data("progress",e).data("timeLeft",c);var s=Math.ceil(c/1e3),t=Math.floor(s/60)%60,u=Math.floor(s/3600),v=s%60;v=("0"+v).slice(-2),t=("0"+t).slice(-2),u=("0"+u).slice(-2);var w=[u,t,v];0!==c&&DisplayText.setTime(w.join(""),"crossfade")},complete:function(){Events.publish("done"),localStorage.setItem("timeStarted",0),localStorage.setItem("durationSet",0)}})}function g(){i.velocity("stop")}var h,i,j=.99999;return Events.subscribe("start",b),Events.subscribe("edit",g),Events.subscribe("edit",c),Events.subscribe("pause",g),Events.subscribe("pause",e),Events.subscribe("resume",d),{init:a,wind:f}}(),Display=function(){"use strict";function a(){e=$("#display"),e.data("inputMode",!0)}function b(){e.velocity("stop").velocity({height:"90%",translateY:0},{duration:globals.ANIMATION_DURATION,easing:globals.EASE_OUT})}function c(){e.data("inputMode",!0).data("paused",!1).removeClass("running").velocity("stop").velocity({height:"20%"},{duration:globals.ANIMATION_DURATION,easing:globals.EASE_OUT})}function d(){e.removeClass("running")}var e;return Events.subscribe("startup.given",function(){$.Velocity.hook(e,"translateY","-100%")}),Events.subscribe("startup.normal",function(){$.Velocity.hook(e,"height","100%"),e.velocity({height:"20%"},{easing:globals.EASE_OUT,duration:globals.ANIMATION_DURATION,complete:function(){function a(){return b+c-(new Date).getTime()}var b=parseInt(localStorage.getItem("timeStarted")),c=parseInt(localStorage.getItem("durationSet"));if(b&&c){var d=5;if(a()>1e3*d){var e="Seems like the timer was still running when you last closed this app. Do you want to restore the timer?",f={text:"No",style:"alert",clickFunction:function(){localStorage.setItem("timeStarted","0"),localStorage.setItem("durationSet","0")}},g={text:"Sure",style:"emphasize",clickFunction:function(){var b=1-a()/c;a()>0?($("#dial-ring path").data("timeLeft",a()).data("progress",b),App.startTimer(!1,!0)):NotificationBanner.show("Too late, the timer has already ended")}};NotificationBanner.show(e,[f,g])}}}})}),Events.subscribe("start",b),Events.subscribe("edit",c),Events.subscribe("done",d),{init:a,get inputMode(){return e.data("inputMode")},set inputMode(a){a?e.data("inputMode",!0).data("paused",!1).removeClass("running"):e.data("inputMode",!1).addClass("running")},get paused(){return e.data("paused")},set paused(a){e.data("paused",a)},get running(){return e.hasClass("running")},done:d}}(),DisplayText=function(){"use strict";function a(){e=$("#display-text"),e.data("currentTime","000000"),$.Velocity.hook(e,"translateX","-50%"),$.Velocity.hook(e,"translateY","-50%"),e.click(App.togglePause)}function b(a){var b=3600*a.slice(-6,-4),c=60*a.slice(-4,-2),d=1*a.slice(-2),e=b+c+d;return e>0&&36e4>e}function c(a,b){var c=!1,d="",f="1rem",g="",h=$("#display-text").clone(!0).attr("id","display-text-old");switch(a){case"000000":case"":a="0s";case"Done":g="000000";case"Paused":d=a,c=!0;break;default:if(e.data("currentTime")!==a||"Paused"===e.text()){for(var i=[],j=["h","m","s"],k=0;3>k;k++){var l=a.slice(2*k,2*k+2);(l>0||i[0]||2===k)&&(10>l&&!i[0]&&(l=l.slice(-1)),i.push(l+j[k]))}var m=i.join(" ");if(.9*globals.windowHeight>globals.windowWidth&&m.length>8){if(globals.windowHeight<1.5*globals.windowWidth){var n=1/.9,o=1.5,p=globals.windowHeight/globals.windowWidth,q=(o-p)/(o-n);f=8/m.length*(1-q)+q}else f=8/m.length;f+="rem"}g=a,d=m,c=!0}}if(c){if($("#display-text-old").remove(),"crossfade"===b){var r=$("#display-text").text(),s=d,t="",u="";if(r.length===s.length)for(var v=0;v<r.length;v++)r[v]===s[v]?(t+=r[v],u+=s[v]):(t+="<span>"+r[v]+"</span>",u+="<span>"+s[v]+"</span>");else t="<span>"+r+"</span>",u="<span>"+s+"</span>";var w=/<\/span><span>/gi;h.html(t.replace(w,"").replace(" ","&nbsp;")).children("span").velocity({opacity:[0,1],scale:0},{easing:globals.EASE_OUT,duration:Math.min(globals.ANIMATION_DURATION,1e3),queue:!1,display:"inline-block",complete:function(){$(this).parent().remove()}}).end().prependTo(e.parent()),e.html(u.replace(w,"").replace(" ","&nbsp;")).css({fontFamily:"robotoregular"}).children("span").css("opacity",0).velocity({opacity:1,scale:[1,0]},{easing:globals.EASE_OUT,duration:Math.min(globals.ANIMATION_DURATION,1e3),queue:!1,display:"inline-block",complete:function(){$(this).contents().unwrap()}})}else e.css({fontFamily:"robotoregular"}).html(d);e.data("currentTime",g).add(h).velocity({fontSize:f},{easing:globals.EASE_OUT,duration:globals.ANIMATION_DURATION,queue:!1})}}function d(a){c((e.data("currentTime")+a).slice(-6))}var e;return Events.subscribe("startup.normal",function(){$.Velocity.hook(e,"opacity",0),e.velocity({opacity:1},{easing:globals.EASE_OUT,duration:globals.ANIMATION_DURATION})}),Events.subscribe("edit",function(){c(e.data("currentTime"),"crossfade")}),Events.subscribe("done",function(){c("Done","crossfade")}),{init:a,addDigit:d,setTime:c,validateTime:b,get time(){return e.data("currentTime")}}}(),EditButton=function(){"use strict";function a(){d=$("#edit-button"),d.click(App.editTime)}function b(){d.velocity("stop").velocity({translateY:[0,"100%"],opacity:[1,0]},{easing:globals.EASE_OUT,duration:globals.ANIMATION_DURATION,display:"block"})}function c(){d.velocity("stop").velocity({opacity:0,translateY:"-700%"},{easing:globals.EASE_OUT,display:"none",duration:globals.ANIMATION_DURATION,complete:function(){$.Velocity.hook($(this),"translateY","0")}})}var d;return Events.subscribe("start",b),Events.subscribe("edit",c),{init:a}}(),HelpMenu=function(){"use strict";function a(){c=$("#keyboard-help"),$.Velocity.hook(c,"translateX","-50%"),$.Velocity.hook(c,"translateY","-50%"),navigator.platform.match(/(Mac|iPhone|iPod|iPad)/i)&&c.find(".delete").text("Delete")}function b(a){if(0===arguments.length){var d=!c.data("shown");c.data("shown",d).velocity("stop").velocity({scaleY:d?[1,0]:[0,1],scaleX:d?[1,.5]:[0,1],opacity:d?[1,0]:[0,1]},{easing:d?globals.EASE_OUT:globals.EASE_IN,display:d?"block":"none",duration:d?globals.ANIMATION_DURATION:globals.ANIMATION_DURATION/2})}else(c.data("shown")||!1)!==a&&b()}var c;return{init:a,toggle:b}}(),Keypad=function(){"use strict";function a(){d=$("#keypad"),$.Velocity.hook(d,"translateX","-50%"),$.Velocity.hook(d,"translateY","20%"),$.Velocity.hook(d,"opacity",0),d.on("click","td",function(){var a=$(this).text();"Clear"===a?DisplayText.setTime(""):"Start"===a?App.startTimer():DisplayText.addDigit(a)})}function b(){d.velocity("stop").velocity({translateY:"20%",opacity:0},{easing:globals.EASE_OUT,duration:globals.ANIMATION_DURATION,display:"none"})}function c(){d.velocity("stop").velocity({translateY:0,opacity:1},{easing:globals.EASE_OUT,duration:globals.ANIMATION_DURATION,display:"table"})}var d;return Events.subscribe("startup.normal",c),Events.subscribe("start",b),Events.subscribe("edit",c),{init:a}}(),globals={EASE_OUT:"easeOutExpo",EASE_IN:"easeInExpo",ANIMATION_DURATION:300,windowWidth:null,windowHeight:null,startupType:null,startupTime:null};$(function(){"use strict";App.init(),Display.init(),Keypad.init(),DisplayText.init(),NotificationBanner.init(),HelpMenu.init(),EditButton.init(),DialRing.init(),Events.publish("startup")});var NotificationBanner=function(){"use strict";function a(){e=$("#notification-banner"),f=e.find("span"),e.on("click",".button",c)}function b(a,b){f.text(a);var c=f.siblings("div").empty();if(b){$("#content").css("pointer-events","none");for(var d=b.length-1;d>=0;d--){var h=b[d];$("<div></div>").text(h.text).addClass(h.style+" button").click(h.clickFunction).prependTo(c)}}else clearTimeout(g),g=setTimeout(NotificationBanner.hide,5e3);e.velocity("stop").velocity({translateY:e.data("shown")?0:[0,"-100%"]},{easing:globals.EASE_OUT,display:"block",duration:globals.ANIMATION_DURATION,complete:function(){b?$("#content").on("click.bannerhide",NotificationBanner.hide):$(document).on("click.bannerhide",NotificationBanner.hide)}}).data("shown",!0)}function c(){$(document).off("click.bannerhide",NotificationBanner.hide),$("#content").off("click.bannerhide",NotificationBanner.hide).css("pointer-events",""),e.data("shown")&&e.data("shown",!1).velocity("stop").velocity({translateY:"-100%"},{easing:globals.EASE_IN,display:"none",duration:globals.ANIMATION_DURATION/2})}function d(a){e.find("."+a).click()}var e,f,g;return{init:a,show:b,hide:c,clickButton:d,get isShown(){return e.data("shown")},get isEmpty(){return""!==e.find("div").text()}}}();